# 25. 01. 16

## Team Project (EatPlatFrom) 작업 진행

### map.jsp 페이징 구조 개선

```
기존 시스템에서 스크롤 페이징 시스템은 문제가 없었지만,
넘버링 페이징의 경우

1. loadedDataCount의 계산 오류

- 여태 loadedDataCount가 전체 데이터를 계산한다고 생각했었지만,
현재의 시스템에선 한 컨테이너(5개 페이지 묶음)에서의 데이터만 세어야 하는 것으로 확인 후 수정

2. 버튼 레이어 표시 조정

- 기존에는 제한 없이 컨테이너가 존재한다면 페이지 버튼이 출력 됐었지만,
현재는 현재 컨테이너의 반경 2 범위의 버튼만 표시 되도록 수정ㅈ

ex) 4페이지 기준 2/3/4/5/6

예외 1) 현재 컨테이너의 반경 2개의 범위 페이지보다 총 페이지가 부족 할 때
* 편의상 컨테이너를 페이지로 칭함.

ex) 1,2페이지의 경우 -2 범위의 컨텐츠가 부족하기 때문에 
해당 상황에서는 1/2/3/4/5 형식으로 표시 되도록 예외 처리

ex2) 마지막 페이지 -1, 마지막 페이지의 경우 +2 범위의 컨텐츠가 부족하기 때문에
해당 상황에서는 마지막 페이지 -2의 반경 범위를 표시하도록 설정
예시로 마지막 페이지가 8 일 경우 마지막 페이지 -1, 마지막 페이지는
4/5/6/7/8 형태로 출력 됨.

3. currentPage 계산 오류 수정

- 기존 currentPage의 계산 방식은 if(i!==1)(i-1) * 6을 사용하였는데
해당 방식은 테스트 환경이었던 2페이지 기준으로 작성되었던 것을 확인하고
currentPage를 계산하는 수식을 변경.

변경 수식은
((i-1)*5) + 1

기존에 구상했던 오류는 눈에 보이는 1,2 페이지만 가지고 판단하다보니
이후 숫자의 계산을 예상하지 않았던 것.
해당 수식으로 변경 후에
기존 i==1 때의 조건 또한 상쇄되기에 코드의 경량화가 이루어짐
```

### map.jsp / list.jsp select 정렬 방식 수정

* 기존 STORE_REG_DATE를 기준으로 정렬하던 방식에서 같은 시간 대에 등록된 게시글은 정렬이 안되는 것을 확인
* select 문에 store.STORE_REG_DATE, store.STORE_ID의 조건을 포함하여 등록일자 비교 후 동일할 경우 STORE_ID로 한 번 더 판별 후 정렬 되도록 수정

### 예약 관리 calendar 구조 개선

```

1. 인원 변경을 시도하면 선택된 시간 셀의 선택이 해제되는 현상을 발견

- 해당 문제를 해결하기 위해 인원 변경을 적용하는 시점에 저장된 data-time-value와 동일한 data를 가지고 있는 
항목을 trigger.click으로 접근하려 했으나
비동기 통신의 실행 로직 때문에
호출 순서를 조정해도 trigger.click이 묻히는 현상이 발생함.
최종적으로 처리한 방식은 DOM 메소드인 Mutataionobserv를 사용하여
해당 엘리먼트에 대한 변화가 발생할 때 마다 추적 후 trigger.click을 발생시키도록 구현

2. 인원 변경을 시도하면 예약 여부 조회 기능이 작동하지 않는 현상을 발견

- 예약 시스템에서 인원 조작( +, -, 직접 입력 후 적용 버튼 클릭 등)을 시도하면
비동기 통신으로 구현한 현재 예약 인원을 비교하는 시스템이 초기화 되는 현상을 발견
원인으로는 인원 변경을 하는 트리거에서 generateTimeSlots 함수에서 선언한
시간 값을 저장하는 변수를 사용하는 것이 문제로 판별됨.
이후 해당 시간을 저장하는 다른 변수를 생성하여 대체 후 해결
```